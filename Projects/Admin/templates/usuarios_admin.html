<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios - {{ project_name }} Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e1a;
            color: #ffffff;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: 
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 0;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        header {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
        }
        
        .brand { display: flex; align-items: center; gap: 15px; }
        .brand-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, #c5a572 0%, #8b7355 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .brand-text h1 {
            font-size: 1.5rem;
            font-weight: 300;
            color: #ffffff;
            letter-spacing: -0.5px;
        }
        .brand-text h1 strong {
            font-weight: 700;
            background: linear-gradient(135deg, #c5a572 0%, #f4e4c1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .user-info { display: flex; align-items: center; gap: 20px; }
        .user-name { font-weight: 500; color: rgba(255,255,255,0.9); }
        .btn-logout {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-logout:hover {
            background: rgba(255,77,77,0.1);
            border-color: rgba(255,77,77,0.3);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.04);
            padding: 10px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .tab-btn {
            flex: 1;
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.6);
            font-size: 1rem;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .tab-btn:hover {
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.9);
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #c5a572 0%, #8b7355 100%);
            color: #fff;
        }
        
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        .filters-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        .filters-grid {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 15px;
            align-items: end;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 0.95rem;
        }
        .btn-search {
            padding: 12px 25px;
            background: linear-gradient(135deg, #c5a572 0%, #8b7355 100%);
            border: none;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(197, 165, 114, 0.3);
        }
        
        .table-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 15px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead {
            background: rgba(255,255,255,0.05);
        }
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.8);
        }
        tbody tr:hover {
            background: rgba(255,255,255,0.02);
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .badge.activo {
            background: rgba(46, 213, 115, 0.15);
            color: #2ed573;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }
        .badge.inactivo {
            background: rgba(255, 107, 107, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        .btn-action {
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-action:hover {
            background: rgba(197, 165, 114, 0.2);
            border-color: #c5a572;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.5);
        }
        .empty {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.5);
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #1a1f2e;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .modal-header h2 {
            font-size: 1.5rem;
            color: #fff;
        }
        .modal-close {
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .modal-close:hover {
            color: #ff6b6b;
        }
        .modal-body {
            margin-bottom: 20px;
        }
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .btn-primary {
            padding: 12px 25px;
            background: linear-gradient(135deg, #c5a572 0%, #8b7355 100%);
            border: none;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(197, 165, 114, 0.3);
        }
        .btn-secondary {
            padding: 12px 25px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Navigation Menu */
        .nav-menu {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }
        .nav-menu a {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        .nav-menu a:hover {
            background: rgba(255,255,255,0.05);
            color: #fff;
            border-color: rgba(197, 165, 114, 0.5);
        }
        .nav-menu a.active {
            background: linear-gradient(135deg, #c5a572 0%, #8b7355 100%);
            color: #fff;
            border-color: transparent;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="brand">
                <div class="brand-icon">
                    <i class="fas fa-store"></i>
                </div>
                <div class="brand-text">
                    <h1>{{ project_name }} <strong>Admin</strong></h1>
                </div>
            </div>
            <div class="user-info">
                <span class="user-name"><i class="fas fa-user-circle"></i> <span id="username">Admin</span></span>
                <button class="btn-logout" onclick="cerrarSesion()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </header>

        <nav class="nav-menu">
            <a href="/admin/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
            <a href="/admin/productos"><i class="fas fa-box"></i> Productos</a>
            <a href="/admin/pedidos"><i class="fas fa-shopping-cart"></i> Pedidos</a>
            <a href="/admin/presupuestos"><i class="fas fa-file-invoice"></i> Presupuestos</a>
            <a href="/admin/carritos"><i class="fas fa-shopping-basket"></i> Carritos</a>
            <a href="/admin/usuarios" class="active"><i class="fas fa-users"></i> Clientes</a>
            <a href="/admin/configuracion"><i class="fas fa-cog"></i> Configuración</a>
        </nav>

        <div class="tabs">
            <button class="tab-btn active" onclick="cambiarTab('clientes')">
                <i class="fas fa-users"></i>
                Clientes (E-commerce)
            </button>
            <button class="tab-btn" onclick="cambiarTab('admins')">
                <i class="fas fa-user-shield"></i>
                Usuarios Admin
            </button>
        </div>

        <!-- TAB: Clientes E-commerce -->
        <div id="tab-clientes" class="tab-content active">
            <div class="filters-card">
                <div class="filters-grid">
                    <div class="form-group">
                        <label>Buscar</label>
                        <input type="text" id="search-clientes" placeholder="Buscar por nombre o email...">
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="filter-activo-clientes">
                            <option value="">Todos</option>
                            <option value="true">Activos</option>
                            <option value="false">Inactivos</option>
                        </select>
                    </div>
                    <button class="btn-search" onclick="cargarClientes()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
            </div>

            <div class="table-card">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Teléfono</th>
                            <th>Dirección</th>
                            <th>Estado</th>
                            <th>Fecha Registro</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-clientes">
                        <tr><td colspan="8" class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: Usuarios Admin -->
        <div id="tab-admins" class="tab-content">
            <div class="filters-card">
                <div class="filters-grid">
                    <div class="form-group">
                        <label>Buscar</label>
                        <input type="text" id="search-admins" placeholder="Buscar por usuario, nombre o email...">
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="filter-activo-admins">
                            <option value="">Todos</option>
                            <option value="true">Activos</option>
                            <option value="false">Inactivos</option>
                        </select>
                    </div>
                    <button class="btn-search" onclick="cargarAdmins()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
            </div>

            <div class="table-card">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Fecha Creación</th>
                            <th>Último Acceso</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-admins">
                        <tr><td colspan="8" class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Editar Cliente -->
    <div id="modal-editar" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Cliente</h2>
                <button class="modal-close" onclick="cerrarModal('modal-editar')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-usuario-id">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" id="edit-nombre" placeholder="Nombre completo">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="edit-email" placeholder="email@ejemplo.com">
                </div>
                <div class="form-group">
                    <label>Teléfono</label>
                    <input type="text" id="edit-telefono" placeholder="+54 11 1234 5678">
                </div>
                <div class="form-group">
                    <label>Dirección</label>
                    <input type="text" id="edit-direccion" placeholder="Calle, número, piso">
                </div>
                <div class="form-group">
                    <label>Ciudad</label>
                    <input type="text" id="edit-ciudad" placeholder="Ciudad">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-editar')">Cancelar</button>
                <button class="btn-primary" onclick="guardarEdicion()"><i class="fas fa-save"></i> Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Cambiar Contraseña -->
    <div id="modal-password" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> Cambiar Contraseña</h2>
                <button class="modal-close" onclick="cerrarModal('modal-password')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="password-usuario-id">
                <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
                    <strong id="password-usuario-nombre"></strong>
                </p>
                <div class="form-group">
                    <label>Nueva Contraseña</label>
                    <input type="password" id="nueva-password" placeholder="Mínimo 6 caracteres">
                </div>
                <div class="form-group">
                    <label>Confirmar Contraseña</label>
                    <input type="password" id="confirmar-password" placeholder="Repetir contraseña">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-password')">Cancelar</button>
                <button class="btn-primary" onclick="guardarPassword()"><i class="fas fa-check"></i> Cambiar</button>
            </div>
        </div>
    </div>

    <!-- Modal Ver Detalles -->
    <div id="modal-detalle" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user"></i> Detalles del Cliente</h2>
                <button class="modal-close" onclick="cerrarModal('modal-detalle')">&times;</button>
            </div>
            <div class="modal-body" id="detalle-contenido">
                <!-- Se llenará dinámicamente -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-detalle')">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let tabActual = 'clientes';

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            verificarAutenticacion();
            cargarClientes();
        });

        // Autenticación
        function verificarAutenticacion() {
            const token = localStorage.getItem('admin_token');
            const userStr = localStorage.getItem('admin_user');
            
            if (!token || !userStr) {
                window.location.href = '/admin/login';
                return;
            }
            
            try {
                const user = JSON.parse(userStr);
                document.getElementById('username').textContent = user.nombre || user.username || 'Usuario';
            } catch (e) {
                console.error('Error parsing user:', e);
            }
        }

        function cerrarSesion() {
            localStorage.removeItem('admin_token');
            localStorage.removeItem('admin_user');
            window.location.href = '/admin/login';
        }

        // Cambiar tabs
        function cambiarTab(tab) {
            tabActual = tab;
            
            // Actualizar botones
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.tab-btn').classList.add('active');
            
            // Actualizar contenido
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // Cargar datos
            if (tab === 'clientes') {
                cargarClientes();
            } else {
                cargarAdmins();
            }
        }

        // Cargar clientes (usuarios ecommerce)
        async function cargarClientes() {
            const tbody = document.getElementById('tabla-clientes');
            tbody.innerHTML = '<tr><td colspan="8" class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando...</td></tr>';
            
            try {
                const search = document.getElementById('search-clientes').value;
                const activo = document.getElementById('filter-activo-clientes').value;
                
                let url = '/admin/usuarios/api/ecommerce/list?';
                if (search) url += `search=${encodeURIComponent(search)}&`;
                if (activo) url += `activo=${activo}&`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Error al cargar clientes');
                }
                
                const data = await response.json();
                const usuarios = data.usuarios || [];
                
                if (usuarios.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="empty">No se encontraron clientes</td></tr>';
                    return;
                }
                
                tbody.innerHTML = usuarios.map(u => `
                    <tr>
                        <td>${u.id.substring(0, 8)}...</td>
                        <td>${u.nombre || '-'}</td>
                        <td>${u.email || '-'}</td>
                        <td>${u.telefono || '-'}</td>
                        <td>${u.direccion || '-'}</td>
                        <td><span class="badge ${u.activo ? 'activo' : 'inactivo'}">${u.activo ? 'Activo' : 'Inactivo'}</span></td>
                        <td>${u.fecha_registro ? new Date(u.fecha_registro).toLocaleDateString() : '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action" onclick="verDetalleCliente('${u.id}')" title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-action" onclick="editarCliente('${u.id}')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-action" onclick="cambiarPasswordCliente('${u.id}')" title="Cambiar contraseña">
                                    <i class="fas fa-key"></i>
                                </button>
                                <button class="btn-action" onclick="toggleEstadoCliente('${u.id}', ${u.activo})" title="${u.activo ? 'Desactivar' : 'Activar'}">
                                    <i class="fas fa-${u.activo ? 'ban' : 'check'}"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error:', error);
                tbody.innerHTML = `<tr><td colspan="8" class="empty">Error al cargar clientes: ${error.message}</td></tr>`;
            }
        }

        // Cargar usuarios admin
        async function cargarAdmins() {
            const tbody = document.getElementById('tabla-admins');
            tbody.innerHTML = '<tr><td colspan="8" class="loading"><i class="fas fa-spinner fa-spin"></i> Cargando...</td></tr>';
            
            try {
                const search = document.getElementById('search-admins').value;
                const activo = document.getElementById('filter-activo-admins').value;
                
                let url = '/admin/usuarios/api/sistema/list?';
                if (search) url += `search=${encodeURIComponent(search)}&`;
                if (activo) url += `activo=${activo}&`;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Error al cargar usuarios admin');
                }
                
                const data = await response.json();
                const usuarios = data.usuarios || [];
                
                if (usuarios.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="empty">No se encontraron usuarios admin</td></tr>';
                    return;
                }
                
                tbody.innerHTML = usuarios.map(u => `
                    <tr>
                        <td>${u.id.substring(0, 8)}...</td>
                        <td>${u.usuario || '-'}</td>
                        <td>${u.nombre || '-'}</td>
                        <td>${u.email || '-'}</td>
                        <td><span class="badge ${u.activo ? 'activo' : 'inactivo'}">${u.activo ? 'Activo' : 'Inactivo'}</span></td>
                        <td>${u.fecha_creacion ? new Date(u.fecha_creacion).toLocaleDateString() : '-'}</td>
                        <td>${u.ultimo_acceso ? new Date(u.ultimo_acceso).toLocaleDateString() : '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action" onclick="toggleEstadoAdmin('${u.id}', ${u.activo})" title="${u.activo ? 'Desactivar' : 'Activar'}">
                                    <i class="fas fa-${u.activo ? 'ban' : 'check'}"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error:', error);
                tbody.innerHTML = `<tr><td colspan="8" class="empty">Error al cargar usuarios admin: ${error.message}</td></tr>`;
            }
        }

        // Toggle estado cliente
        async function toggleEstadoCliente(id, estadoActual) {
            if (!confirm(`¿Está seguro de ${estadoActual ? 'desactivar' : 'activar'} este cliente?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/usuarios/api/ecommerce/${id}/toggle-active`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Error al cambiar estado');
                }
                
                cargarClientes();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Toggle estado admin
        async function toggleEstadoAdmin(id, estadoActual) {
            if (!confirm(`¿Está seguro de ${estadoActual ? 'desactivar' : 'activar'} este usuario admin?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/usuarios/api/sistema/${id}/toggle-active`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Error al cambiar estado');
                }
                
                cargarAdmins();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Ver detalle de cliente
        async function verDetalleCliente(id) {
            try {
                const response = await fetch(`/admin/usuarios/api/ecommerce/${id}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) throw new Error('Error al cargar detalles');
                
                const usuario = await response.json();
                
                document.getElementById('detalle-contenido').innerHTML = `
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">ID:</strong><br>
                            <span style="color: #fff;">${usuario.id}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Nombre:</strong><br>
                            <span style="color: #fff;">${usuario.nombre || '-'}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Email:</strong><br>
                            <span style="color: #fff;">${usuario.email || '-'}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Teléfono:</strong><br>
                            <span style="color: #fff;">${usuario.telefono || '-'}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Dirección:</strong><br>
                            <span style="color: #fff;">${usuario.direccion || '-'}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Ciudad:</strong><br>
                            <span style="color: #fff;">${usuario.ciudad || '-'}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Estado:</strong><br>
                            <span class="badge ${usuario.activo ? 'activo' : 'inactivo'}">${usuario.activo ? 'Activo' : 'Inactivo'}</span>
                        </div>
                        <div>
                            <strong style="color: rgba(255,255,255,0.5);">Fecha de Registro:</strong><br>
                            <span style="color: #fff;">${usuario.fecha_registro ? new Date(usuario.fecha_registro).toLocaleString() : '-'}</span>
                        </div>
                    </div>
                `;
                
                abrirModal('modal-detalle');
            } catch (error) {
                alert('Error al cargar detalles: ' + error.message);
            }
        }

        // Editar cliente
        async function editarCliente(id) {
            try {
                const response = await fetch(`/admin/usuarios/api/ecommerce/${id}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) throw new Error('Error al cargar usuario');
                
                const usuario = await response.json();
                
                document.getElementById('edit-usuario-id').value = usuario.id;
                document.getElementById('edit-nombre').value = usuario.nombre || '';
                document.getElementById('edit-email').value = usuario.email || '';
                document.getElementById('edit-telefono').value = usuario.telefono || '';
                document.getElementById('edit-direccion').value = usuario.direccion || '';
                document.getElementById('edit-ciudad').value = usuario.ciudad || '';
                
                abrirModal('modal-editar');
            } catch (error) {
                alert('Error al cargar usuario: ' + error.message);
            }
        }

        // Guardar edición
        async function guardarEdicion() {
            const id = document.getElementById('edit-usuario-id').value;
            const nombre = document.getElementById('edit-nombre').value;
            const email = document.getElementById('edit-email').value;
            const telefono = document.getElementById('edit-telefono').value;
            const direccion = document.getElementById('edit-direccion').value;
            const ciudad = document.getElementById('edit-ciudad').value;
            
            if (!nombre || !email) {
                alert('Nombre y email son obligatorios');
                return;
            }
            
            try {
                const params = new URLSearchParams({
                    nombre,
                    email,
                    telefono: telefono || '',
                    direccion: direccion || '',
                    ciudad: ciudad || ''
                });
                
                const response = await fetch(`/admin/usuarios/api/ecommerce/${id}?${params}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error al actualizar');
                }
                
                alert('Usuario actualizado exitosamente');
                cerrarModal('modal-editar');
                cargarClientes();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Cambiar contraseña
        function cambiarPasswordCliente(id) {
            document.getElementById('password-usuario-id').value = id;
            document.getElementById('nueva-password').value = '';
            document.getElementById('confirmar-password').value = '';
            abrirModal('modal-password');
        }

        // Guardar nueva contraseña
        async function guardarPassword() {
            const id = document.getElementById('password-usuario-id').value;
            const nuevaPassword = document.getElementById('nueva-password').value;
            const confirmarPassword = document.getElementById('confirmar-password').value;
            
            if (!nuevaPassword || nuevaPassword.length < 6) {
                alert('La contraseña debe tener al menos 6 caracteres');
                return;
            }
            
            if (nuevaPassword !== confirmarPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }
            
            try {
                const params = new URLSearchParams({
                    nueva_password: nuevaPassword
                });
                
                const response = await fetch(`/admin/usuarios/api/ecommerce/${id}/password?${params}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('admin_token')}`
                    }
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error al cambiar contraseña');
                }
                
                alert('Contraseña actualizada exitosamente');
                cerrarModal('modal-password');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Funciones de modal
        function abrirModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function cerrarModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
